# 金字塔网格策略说明

## 策略概述

这是一个高级的**分层金字塔网格策略**，结合了**LIFO 止盈机制**和**永久底仓保留**。

## 📊 资金分配

- **20%** - 底仓 (Core Position) - 永久持有，不卖出
- **60%** - 网格子弹 (Grid Capital) - 用于分层加仓
- **20%** - 备用金 (Reserve) - 预留应急资金

## 🎯 买入逻辑（金字塔加仓）

### Level 0 - 初始建仓

- **触发**: 第一天
- **买入**: 总资金的 **20%**
- **性质**: 底仓，永不卖出

### Level 1 - 第一次加仓

- **触发**: 价格较持仓均价下跌 **5%** 且 **RSI < 40**
- **买入**: 总资金的 **10%**

### Level 2 - 第二次加仓

- **触发**: 价格较 Level 1 买入价再跌 **8%**
- **买入**: 总资金的 **15%**

### Level 3 - 第三次加仓

- **触发**: 价格较 Level 2 买入价再跌 **12%**
- **买入**: 总资金的 **15%**

### Level 4 - 第四次加仓

- **触发**: 价格较 Level 3 买入价再跌 **15%**
- **买入**: 总资金的 **20%**

## 💰 止盈逻辑（LIFO + 永久底仓）

### 触发条件

- 现价较**上一次买入价**上涨 **5%**

### 执行动作

1. **卖出**: 最近一笔买入数量的 **80%** (Last In First Out)
2. **留存**: 剩余的 **20%** 转为底仓，永久持有
3. **保护**: Level 0 的初始底仓永不卖出

## 🔄 仓位管理

### 分层结构

```
总持仓 = 底仓 (Core) + 可交易仓位 (Tradable)

├─ 底仓 (永久持有)
│  ├─ Level 0 初始底仓 (20%)
│  └─ 各层级止盈后留存的 20%
│
└─ 可交易仓位 (LIFO栈)
   ├─ Level 4 (如果触发)
   ├─ Level 3 (如果触发)
   ├─ Level 2 (如果触发)
   └─ Level 1 (如果触发)
```

### LIFO 示例

**场景**: 先买入 Level 1，再买入 Level 2

```
仓位栈:
[Level 1: 100股] ← 底部
[Level 2: 150股] ← 栈顶

当触发止盈时:
1. 卖出 Level 2 的 80% (120股)
2. 留存 Level 2 的 20% (30股) → 转为底仓
3. Level 2 从栈中移除
```

## 📈 策略优势

1. **风险控制**

   - 分层买入，越跌越买，摊低成本
   - 初始底仓保护，确保长期持有
   - RSI 过滤避免抄底过早

2. **收益优化**

   - LIFO 止盈，优先兑现高位买入的利润
   - 利润留存，扩大底仓规模
   - 资金使用效率高

3. **适应性强**
   - 适合震荡市：频繁触发网格
   - 适合趋势市：底仓持续盈利
   - 适合暴跌后反弹：金字塔加仓效果显著

## ⚠️ 风险提示

1. **深度熊市风险**: 连续跌破所有层级后，资金耗尽
2. **趋势判断**: Level 1 需要 RSI<40，可能错过部分反弹机会
3. **资金管理**: 需要确保备用金足够应对极端行情

## 🛠️ 参数调整建议

可在 `strategies.py` 中的 `PyramidGridStrategy.__init__()` 修改：

- `grid_levels`: 调整各层级的跌幅和买入比例
- `profit_trigger`: 调整止盈触发阈值（默认 5%）
- `sell_ratio`: 调整卖出比例（默认 80%）

## 📊 回测指标

- **总收益率**: 相对初始资金的总回报
- **基准收益**: 一次性全仓买入的回报
- **最大回撤**: 从峰值到谷底的最大跌幅
- **底仓股数**: 永久持有的股票数量
- **可交易股数**: 栈中可卖出的股票数量
- **持仓均价**: 所有持仓的平均成本

---

**作者建议**: 这个策略适合对标的有长期信心的投资者。通过逐步建仓和利润留存，实现"波段交易 + 长期投资"的双重收益。
